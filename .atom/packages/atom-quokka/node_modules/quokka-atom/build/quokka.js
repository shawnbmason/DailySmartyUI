module.exports=(function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)})([(function(e,t){e.exports=require("path")}),(function(e,t,i){function n(e){function t(t){return p.apply(e,t)}function i(e,t){return this instanceof i?(m.apply(this,arguments),this):i.apply(Object.create(i.prototype),arguments)}function r(e,t){return this instanceof r?(y.apply(this,arguments),this):r.apply(Object.create(r.prototype),arguments)}function u(e,t,i,n){function r(e,t,i,n){return g(e,t,i,(function(a,c){!a||"EMFILE"!==a.code&&"ENFILE"!==a.code?("function"==typeof n&&n.apply(this,arguments),o()):s([r,[e,t,i,n]])}))}return"function"==typeof i&&(n=i,i=null),r(e,t,i,n)}a(e),e.gracefulify=n,e.FileReadStream=i,e.FileWriteStream=r,e.createReadStream=function(e,t){return new i(e,t)},e.createWriteStream=function(e,t){return new r(e,t)};var l=e.readFile;e.readFile=function(e,t,i){function n(e,t,i){return l(e,t,(function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?("function"==typeof i&&i.apply(this,arguments),o()):s([n,[e,t,i]])}))}return"function"==typeof t&&(i=t,t=null),n(e,t,i)};var d=e.writeFile;e.writeFile=function(e,t,i,n){function r(e,t,i,n){return d(e,t,i,(function(a){!a||"EMFILE"!==a.code&&"ENFILE"!==a.code?("function"==typeof n&&n.apply(this,arguments),o()):s([r,[e,t,i,n]])}))}return"function"==typeof i&&(n=i,i=null),r(e,t,i,n)};var f=e.appendFile;f&&(e.appendFile=function(e,t,i,n){function r(e,t,i,n){return f(e,t,i,(function(a){!a||"EMFILE"!==a.code&&"ENFILE"!==a.code?("function"==typeof n&&n.apply(this,arguments),o()):s([r,[e,t,i,n]])}))}return"function"==typeof i&&(n=i,i=null),r(e,t,i,n)});var p=e.readdir;if(e.readdir=function(e,i,n){var r=[e];return"function"!=typeof i?r.push(i):n=i,r.push((function(e,i){i&&i.sort&&i.sort(),!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?("function"==typeof n&&n.apply(this,arguments),o()):s([t,[r]])})),t(r)},"v0.8"===process.version.substr(0,4)){var h=c(e);i=h.ReadStream,r=h.WriteStream}var m=e.ReadStream;i.prototype=Object.create(m.prototype),i.prototype.open=function(){var e=this;u(e.path,e.flags,e.mode,(function(t,i){t?(e.autoClose&&e.destroy(),e.emit("error",t)):(e.fd=i,e.emit("open",i),e.read())}))};var y=e.WriteStream;r.prototype=Object.create(y.prototype),r.prototype.open=function(){var e=this;u(e.path,e.flags,e.mode,(function(t,i){t?(e.destroy(),e.emit("error",t)):(e.fd=i,e.emit("open",i))}))},e.ReadStream=i,e.WriteStream=r;var g=e.open;return e.open=u,e}function s(e){d("ENQUEUE",e[0].name,e[1]),u.push(e)}function o(){var e=u.shift();e&&(d("RETRY",e[0].name,e[1]),e[0].apply(null,e[1]))}var r=i(5),a=i(19),c=i(21),u=[],l=i(23),d=function(){};l.debuglog&&(d=l.debuglog("gfs4")),e.exports=n(i(10)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&(e.exports=n(r)),e.exports.close=r.close=(function(e){return function(t,i){return e.call(r,t,(function(e){e||o(),"function"==typeof i&&i.apply(this,arguments)}))}})(r.close),e.exports.closeSync=r.closeSync=(function(e){return function(t){var i=e.apply(r,arguments);return o(),i}})(r.closeSync)}),(function(e,t,i){"use strict";t.fromCallback=function(e){return Object.defineProperty((function(){if("function"!=typeof arguments[arguments.length-1])return new Promise((t,i)=>{arguments[arguments.length]=((e,n)=>{if(e)return i(e);t(n)}),arguments.length++,e.apply(this,arguments)});e.apply(this,arguments)}),"name",{value:e.name})},t.fromPromise=function(e){return Object.defineProperty((function(){const t=arguments[arguments.length-1];if("function"!=typeof t)return e.apply(this,arguments);e.apply(this,arguments).then(e=>t(null,e),t)}),"name",{value:e.name})}}),(function(e,t,i){"use strict";const n=(0,i(2).fromCallback)(i(27)),s=i(28);e.exports={mkdirs:n,mkdirsSync:s,mkdirp:n,mkdirpSync:s,ensureDir:n,ensureDirSync:s}}),(function(e,t,i){"use strict";const n=i(2).fromPromise,s=i(9);e.exports={pathExists:n((function(e){return s.access(e).then(()=>!0).catch(()=>!1)})),pathExistsSync:s.existsSync}}),(function(e,t){e.exports=require("fs")}),(function(e,t){e.exports=require("os")}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(31);e.exports={remove:n(s),removeSync:s.sync}}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(33);e.exports={readJson:n(s.readFile),readJsonSync:s.readFileSync,writeJson:n(s.writeFile),writeJsonSync:s.writeFileSync}}),(function(e,t,i){const n=i(2).fromCallback,s=i(1),o=["access","appendFile","chmod","chown","close","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"];"function"==typeof s.mkdtemp&&o.push("mkdtemp"),Object.keys(s).forEach(e=>{t[e]=s[e]}),o.forEach(e=>{t[e]=n(s[e])}),t.exists=function(e,t){return"function"==typeof t?s.exists(e,t):new Promise(t=>s.exists(e,t))},t.read=function(e,t,i,n,o,r){return"function"==typeof r?s.read(e,t,i,n,o,r):new Promise((r,a)=>{s.read(e,t,i,n,o,(e,t,i)=>{if(e)return a(e);r({bytesRead:t,buffer:i})})})},t.write=function(e,t,i,n,o,r){return"function"==typeof arguments[arguments.length-1]?s.write(e,t,i,n,o,r):"string"==typeof t?new Promise((o,r)=>{s.write(e,t,i,n,(e,t,i)=>{if(e)return r(e);o({bytesWritten:t,buffer:i})})}):new Promise((r,a)=>{s.write(e,t,i,n,o,(e,t,i)=>{if(e)return a(e);r({bytesWritten:t,buffer:i})})})}}),(function(e,t,i){"use strict";var n=i(5);e.exports=(function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Object)t={__proto__:e.__proto__};else var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t})(n)}),(function(e,t){e.exports=require("assert")}),(function(e,t,i){var n=i(1),s=i(0),o=i(26);e.exports=function(e,t,i,r){function a(e){if(L++,E)if(E instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!E.test(e))return v(!0)}else if("function"==typeof E&&!E(e,t))return v(!0);return c(e)}function c(e){N++,(O?n.stat:n.lstat)(e,(function(t,i){if(t)return _(t);var n={name:e,mode:i.mode,mtime:i.mtime,atime:i.atime,stats:i};return i.isDirectory()?f(n):i.isFile()||i.isCharacterDevice()||i.isBlockDevice()?u(n):i.isSymbolicLink()?m(e):void 0}))}function u(e){var t=e.name.replace(w,b.replace("$","$$$$"));k(t,(function(i){i?l(e,t):C?d(t,(function(){l(e,t)})):T?_(Error(t+" already exists")):v()}))}function l(e,t){var i=n.createReadStream(e.name),s=n.createWriteStream(t,{mode:e.mode});i.on("error",_),s.on("error",_),x?x(i,s,e):s.on("open",(function(){i.pipe(s)})),s.once("close",(function(){n.chmod(t,e.mode,(function(i){if(i)return _(i);P?o.utimesMillis(t,e.atime,e.mtime,(function(e){return e?_(e):v()})):v()}))}))}function d(e,t){n.unlink(e,(function(e){return e?_(e):t()}))}function f(e){var t=e.name.replace(w,b.replace("$","$$$$"));k(t,(function(i){if(i)return p(e,t);h(e.name)}))}function p(e,t){n.mkdir(t,e.mode,(function(i){if(i)return _(i);n.chmod(t,e.mode,(function(t){if(t)return _(t);h(e.name)}))}))}function h(e){n.readdir(e,(function(t,i){return t?_(t):(i.forEach((function(t){a(s.join(e,t))})),v())}))}function m(e){var t=e.replace(w,b);n.readlink(e,(function(e,i){if(e)return _(e);y(i,t)}))}function y(e,t){O&&(e=s.resolve(S,e)),k(t,(function(i){if(i)return g(e,t);n.readlink(t,(function(i,n){return i?_(i):(O&&(n=s.resolve(S,n)),n===e?v():d(t,(function(){g(e,t)})))}))}))}function g(e,t){n.symlink(e,t,(function(e){return e?_(e):v()}))}function k(e,t){n.lstat(e,(function(e){return t(!!e&&"ENOENT"===e.code)}))}function _(e){if(!M&&void 0!==r)return M=!0,r(e)}function v(e){if(e||N--,q++,L===q&&0===N&&void 0!==r)return r(null)}r||(r=i,i={});var S=process.cwd(),w=s.resolve(S,e),b=s.resolve(S,t),E=i.filter,x=i.transform,C=i.overwrite;void 0===C&&(C=i.clobber),void 0===C&&(C=!0);var T=i.errorOnExist,O=i.dereference,P=!0===i.preserveTimestamps,L=0,q=0,N=0,M=!1;a(w)}}),(function(e,t,i){"use strict";function n(e){return(e=s.normalize(s.resolve(e)).split(s.sep)).length>0?e[0]:null}const s=i(0),o=/[<>:"|?*]/;e.exports={getRootPath:null,invalidWin32Path:function(e){const t=n(e);return e=e.replace(t,""),o.test(e)}}}),(function(e,t,i){e.exports={copySync:i(29)}}),(function(e,t){e.exports=function(e){if("function"==typeof Buffer.allocUnsafe)try{return Buffer.allocUnsafe(e)}catch(t){return new Buffer(e)}return new Buffer(e)}}),(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(0),s=i(17),o=i(6),r=i(46),a=300,c=3500,u=500,l=50,d="quokka";let f=0;const p={automatic:0,onsave:1,once:2};class h{activate(e){var t=this;const n=this;this._$=e.atomViews.$,this._View=e.atomViews.View,this._TextEditorView=e.atomViews.TextEditorView,this._statusBar=e.statusBar,this._Session=e.extendedCoreClient.Session,this._dmp=e.extendedCoreClient.dmp,this._utils=e.extendedCoreClient.utils,this._CompositeDisposable=e.atom.CompositeDisposable,(this._disposables=new this._CompositeDisposable).add(atom.commands.add("atom-workspace",{"quokka:toggle-output":function(){return t.togglePanel()},"quokka:focus-output":function(){return t.togglePanel(!0)},"quokka:create-javascript-file":function(){return t._newFile("js")},"quokka:create-typescript-file":function(){return t._newFile("ts")},"quokka:stop-all":function(){return t._stopAll()},"quokka:manage-license":function(e){return t._showLicense()},"quokka:switch-to-pro-edition":function(e){return t._switchEdition(!0,t._activeSession)},"quokka:switch-to-community-edition":function(e){return t._switchEdition(!1,t._activeSession)}})),this._disposables.add(atom.commands.add("atom-text-editor",{"quokka:make-quokka-from-existing-file":function(e){n.makeQuokkaFromExistingFile(h._getEditor(e,this))},"quokka:run-on-save":function(e){n.runOnSave(h._getEditor(e,this))},"quokka:run-once":function(e){n.runOnce(h._getEditor(e,this))},"quokka:stop-current":function(e){n.stopCurrent(h._getEditor(e,this))},"quokka:install-missing-package-only-for-quokka-file":function(e){n._installPackage(h._getEditor(e,this))},"quokka:install-missing-package-into-project":function(e){n._installPackage(h._getEditor(e,this),!0)},"quokka:show-value":function(e){n._showValue(h._getEditor(e,this),"show")},"quokka:copy-value":function(e){n._showValue(h._getEditor(e,this),"copy")}})),this._activeSessions=[],this._setupEnvironment(),(this._statusElement=this._$('<a tabindex="-1" style="outline:0;" />'))&&(this._statusElement.click((function(){return t.togglePanel()})),this._statusBar&&(this._statusBarTile=this._statusBar.addRightTile({item:this._statusElement[0],priority:-Infinity}))),this._disposables.add({dispose:function(){t._stopAll(),n._panelView&&(n._panelView.hide(),n._panelView.deactivate()),n._statusBarTile&&n._statusBarTile.destroy()}}),this._panelView=new(i(47)(this._$,this._View,this._CompositeDisposable,this._dmp))({navigate:_.bind(this._navigate,this),installPackage:_.bind(this._installPackage,this),hasOpenedProject:atom.project.getPaths().length})}_showLicense(e){var t=this;const n=new(i(49)(this._$,this._View,this._TextEditorView,this._CompositeDisposable,s));let o=atom.workspace.addModalPanel({item:n});n.display({keyFilePath:this._lkp,onlineFilePath:this._ol,parseKey:this._utils.parseKey,closeView:function(i){o.destroy(),i&&(e&&e.dismiss(),t._switchEdition(!0,t._activeSession))}}),setImmediate((function(){return n.focusView()}))}_switchEdition(e,t){const i=this._loadQuokkaConfig();if(i.pro=!!e,this._pro=i.pro,this._saveQuokkaConfig(i),this._pro&&this._salesEvent&&(this._salesEvent.deleteStateConfig(),this._salesEvent.dispose(),delete this._salesEvent),t&&!t.isDisposed()){const e=t.editor;this._stopAll(),t.mode!=p.automatic&&t.mode!=p.onsave||this._start(e,t.mode)}}deactivate(){this._disposables.dispose()}togglePanel(e){e?this._panelView.focusPanel():this._panelView.togglePanel()}makeQuokkaFromExistingFile(e){if(!e)return;const t=this._activeSessions.find((function(t){return t.editor===e}));t&&this._stop(t),this._start(e,p.automatic)}runOnSave(e){if(!this._pro)return void this._showNotification({text:`You are using Quokka.js 'Community' edition (free).<br /><br />The 'Run On save' feature is only available in the Quokka.js 'Pro' edition.`,type:"info",suggestProEdition:!0});if(!e)return;const t=this._activeSessions.find((function(t){return t.editor===e}));t&&this._stop(t),this._start(e,p.onsave)}runOnce(e){if(!this._pro)return void this._showNotification({text:`You are using Quokka.js 'Community' edition (free).<br /><br />The 'Run Once' feature is only available in the Quokka.js 'Pro' edition.`,type:"info",suggestProEdition:!0});if(!e)return;const t=this._activeSessions.find((function(t){return t.editor===e}));t&&t.mode===p.once?this._updateWithChanges(t,e):(t&&this._stop(t),this._start(e,p.once))}stopCurrent(e){const t=this._activeSessions.find((function(t){return t.editor===e}))||this._activeSession;t&&this._stop(t)}_newFile(e){var t=this;const i=`_${e}Grammar`;this[i]||(this[i]=atom.grammars.getGrammars().find((function(t){return t.fileTypes.find((function(t){return t===e}))}))),atom.workspace.open("").then((function(e){t[i]&&e.setGrammar(t[i]),t._start(e,p.automatic)}))}_navigate(e,t){if(!e||!this._activeSession)return;let i,o;_.isNumber(t)?i=t:_.isArray(t)?(i=t[0],o=t[1]):_.isString(t)&&(i=(t=t.split(":"))[0]&&parseInt(t[0],10),o=t[1]&&parseInt(t[1],10)),_.isNumber(i)?i-=1:i=void 0,_.isNumber(o)||(o=void 0);const r=this._activeSession.editor,a=this._getProjectFile(r);if(e===this._activeSession.fileName)r.setCursorBufferPosition([i,o]),atom.workspace.paneForItem(r).activateItem(r),atom.workspace.getActivePane().activate();else if(a.root){const t=n.resolve(a.root,e);s.existsSync(t)&&atom.workspace.open(t,{initialLine:i,initialColumn:o})}}_showValue(e,t){const i=this._activeSession;if(!i)return;if(e||(e=i.editor),!e||e!==i.editor)return;const n=e.getBuffer(),s=e.getSelectedBufferRange();if(!n||!s)return;const o=s.start,r=s.end;if(o.row!==r.row||o.column!==r.column){const e=n.getText();i.evaluateExpressionInEditor(i.fileName,e,[o.row+1,o.column,r.row+1,r.column],t)}}_installPackage(e,t,i){if(!e&&this._activeSession&&(e=this._activeSession.editor),e)if(this._activeSession)if(i)this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:"jsdom-quokka-plugin",plugin:{editConfig:!0}}});else{const i=this._getProjectFile(e),n=i&&i.root;if(t&&!n)return void atom.notifications.addWarning(`Cannot install a package into project because quokka is running outside of an opened project.`);if(!this._pro)return void this._showNotification({text:"The feature is only available in 'Pro' edition.",type:"info",suggestProEdition:!0});if(!this._activeSession.stats||!this._activeSession.stats.errors)return void atom.notifications.addWarning(`No missing packages to install.`);const s=_.find(this._activeSession.stats.errors,(function(e){return e.missingPackage}));if(!s||!s.missingPackage)return void atom.notifications.addWarning(`No missing packages to install.`);this._updateStatus(this._activeSession,"progress"),this._activeSession.runTests({file:this._activeSession.fileName,installPackage:{name:s.missingPackage,local:t}})}else atom.notifications.addWarning(`Cannot install a package because quokka is not running.`,{dismissable:!0})}_getProjectFile(e){let t,i;var n=atom.project.relativizePath(e.getPath());return t=n[0],i=n[1],t&&i?{file:i,root:t}:(t=atom.project.getPaths()[0]||void 0)?{root:t}:void 0}_start(e,t){var i=this;this._updateConfigurationFromSettings();const n=new this._Session,s=new this._CompositeDisposable;t===p.automatic&&s.add(atom.workspace.observeTextEditors((function(t){{if(t===e)return;const i=t.onDidSave((function(){return n.runTests({file:n.fileName,externalFileChange:!0})})),o={dispose:function(){t.disposables.remove(i),t.disposables.remove(o)}};t.disposables.add(o),t.disposables.add(i),s.add(i)}}))),n.mode=t,n.disposable=s,n.id=++f,n.changes=[],n.fileName=d+h._getFileType(e);const o=this._getProjectFile(e),r=o&&o.root;o&&o.file&&o.root&&(n.fileName=o.file),n.editor=e,n.liveConsoleOutput=[],n.changedCursorPositionAtLeastOnce=!1,n.quokkaCoverageMarkers=Object.create(null),n.quokkaCoverageMarkerIdsToLineIds=Object.create(null),n.quokkaLineMessagesCSS=document.createElement("style"),n.quokkaLineMessagesCSS.type="text/css",n.quokkaLineMessagesCSS._lines=0,n.quokkaLineMessagesHideCSS=document.createElement("style"),n.quokkaLineMessagesHideCSS.type="text/css",n.quokkaLineMessagesHideCSS._lines={};const c=atom.views.getView(e).component.rootElement?atom.views.getView(e).component.rootElement.parentNode.children[0]:document.head;c.appendChild(n.quokkaLineMessagesCSS),c.appendChild(n.quokkaLineMessagesHideCSS);const u=e.addGutter({name:"quokka"}),l=this._$(atom.views.getView(u));n.gutter=u,this._activeSessions.push(n);const m={dispose:function(){e.disposables.remove(m),i._stop(n)}};e.disposables.add(m),s.add(e.getBuffer().onDidChange((function(t){n.isDisposed()||(t={start:Math.min(t.newRange.start.row,t.oldRange.start.row),end:Math.max(t.newRange.end.row,t.oldRange.end.row)},n.changes.push(t),n.changedCursorPositionAtLeastOnce&&h._hideInlineMessages(t,e,n),n.mode!==p.automatic&&(n.gutter&&n.gutter.hide(),h._hideInlineMessages({start:1,end:n.editor.getBuffer().getText().split("\n").length},e,n)))}))),s.add(e.onDidSave((function(t){n.isDisposed()||n.mode==p.onsave&&i._updateWithChanges(n,e)}))),s.add(e.onDidChangeCursorPosition((function(){n.changedCursorPositionAtLeastOnce=!0}))),s.add(e.onDidChangeSelectionRange((function(t){if(i._pro&&n.mode===p.automatic){const n=t.newBufferRange,s=n.start,o=n.end;if(s.row!==o.row||s.column!==o.column){const t=i._activeSession;if(t&&e===t.editor){const i=e.getBuffer().getText();t.evaluateExpressionInEditor(t.fileName,i,[s.row+1,s.column,o.row+1,o.column],"show")}}}}))),s.add(e.onDidStopChanging((function(t){n.isDisposed()||!n.changes.length||t&&t.changes&&!t.changes.length&&!n.changedCursorPositionAtLeastOnce||n.mode===p.automatic&&i._updateWithChanges(n,e)}))),n.start({localRoot:r,quokkaFolder:this._quokkaFolder,client:"Atom",cv:atom.getVersion(),fileName:n.fileName}),n.on("notification",(function(e){return i._showNotification(e)})),n.on("busy",(function(){clearTimeout(i._statusUpdateTimeout),i._statusUpdateTimeout=setTimeout((function(){return i._updateStatus(n,"progress")}),a),n.liveConsoleOutput=[],i._scheduleSessionIdleTimeout(n),i._panelView.newResultsExpectedSoon()})),n.on("stopped",(function(e){i._stop(n),i._hideStatusIndicator(),e.deactivate&&(i._stopAll(),atom.packages.getLoadedPackage("atom-quokka").deactivate())})),n.on("started",(function(){console.log(`[Quokka]  #${n.id} Quokka.js started`);const e=i._pro?atom.config.get("quokka-output-position"):void 0;i._panelView.showPanel(e)})),n.on("stats",(function(e){e&&(i._panelView.resultsReport(e),n.stats=e),i._updateStatus(n),delete n.liveConsoleOutput,h._sessionIsActive(n)})),n.on("live",(function(e){n.fileChangedInEditor(n.fileName,n.editor.getBuffer().getText()),n.fileOpenedInEditor(n.fileName)})),n.on("configChanged",(function(e){i._pro=e&&e.pro,i._panelView.setHeaderData(e)})),n.on("documentUpdates",(function(e){return i._updateDocument(n,e)})),n.on("consoleError",(function(e){e&&e.split("\n").forEach((function(e){return e&&console.error(`[Quokka] #${n.id} ${e}`)})),n.emit("stats",e)})),n.on("consoleLog",(function(e){return e&&e.split("\n").forEach((function(e){return e&&console.log(`[Quokka]  #${n.id} ${e}`)}))})),n.on("consoleOutput",(function(e){return i._displayLiveConsoleOutput(n,e)})),this._updateStatus(n,"progress"),s.add({dispose:function(){e.disposables.remove(m),l.off(),u.destroy(),_.each(n.quokkaCoverageMarkers,(function(t){return e.destroyMarker(t.id)})),n.stop(),delete n.editor,delete n.gutter,delete n.disposable,delete n.quokkaCoverageMarkers,delete n.quokkaCoverageMarkerIdsToLineIds,delete n.quokkaLineMessagesCSS,delete n.quokkaLineMessagesHideCSS,delete n.renderingQueue,n===i._activeSession&&delete i._activeSession,i._panelView.clearResults(),console.log(`[Quokka]  #${n.id} Quokka.js stopped`)}})}_updateWithChanges(e,t){var i=this;clearTimeout(this._statusUpdateTimeout),this._statusUpdateTimeout=setTimeout((function(){return i._updateStatus(e,"progress")}),a),e.changes&&e.changes.length?(e.fileChangedInEditor(e.fileName,t.getBuffer().getText(),{start:_.chain(e.changes).map((function(e){return e.start})).min().value()+1,end:_.chain(e.changes).map((function(e){return e.end})).max().value()+1}),e.changes=[]):e.runTests({file:e.fileName})}_stopAll(){var e=this;this._activeSessions.slice().forEach((function(t){return e._stop(t)}))}_displayLiveConsoleOutput(e,t){var i=this;if(!e.liveConsoleOutput)return;const n=e.liveConsoleOutput.started;e.liveConsoleOutput=e.liveConsoleOutput.concat(t),e.liveConsoleOutput.started=n,e.liveConsoleOutput.started?e.displayLiveConsoleOutputTimeout||this._displayPendingLiveConsoleOutput(e):(e.liveConsoleOutput.started=!0,e.displayLiveConsoleOutputTimeout=setTimeout((function(){delete e.displayLiveConsoleOutputTimeout,e.liveConsoleOutput&&e.liveConsoleOutput.length&&(i._panelView.showHeaderOnly(),i._displayPendingLiveConsoleOutput(e))}),150))}_displayPendingLiveConsoleOutput(e){this._panelView.appendConsoleMessages(e.liveConsoleOutput),e.liveConsoleOutput.length=0}_hideStatusIndicator(){this._statusElement&&(this._statusElement.text(""),this._statusElement.removeClass())}_updateStatus(e,t){let i;clearTimeout(this._statusUpdateTimeout),t||(t=_.isString(e.stats)?"failing":e.stats?e.stats.errors.length?"failing":"passing":"failing",i=e.stats&&e.stats.time),t&&this._statusElement&&(this._hideStatusIndicator(),"progress"===t?this._statusElement.addClass("quokka-status progress"):(this._statusElement.addClass("inline-block"),this._statusElement.text(("failing"===t?`\u2717`:`\u2714`)+(i?` ${i} ms`:"")))),this._activeSession=e}_scheduleSessionIdleTimeout(e){var t=this;h._clearIdleSessionTimeout(e),e.idleTimeout=setTimeout((function(){return t._sessionIsIdle(e)}),c)}_sessionIsIdle(e){e.gutter&&e.gutter.hide(),delete e.stats,e.liveConsoleOutput&&!e.liveConsoleOutput.started&&this._panelView.showHeaderOnly()}_updateDocument(e,t){if(e.isDisposed())return;const i=e.editor,n=t[e.fileName];if(!n||!n.lines)return;const s=e.renderingQueue||{operations:[]};e.renderingQueue=s,n.fullUpdate&&(_.each(e.quokkaCoverageMarkers,(function(e){return i.destroyMarker(e.id)})),e.quokkaCoverageMarkers=Object.create(null),e.quokkaCoverageMarkerIdsToLineIds=Object.create(null),s.operations=[]);let o=0;_.each(n.lines,(function(t){o++;let n=e.quokkaCoverageMarkers[t.id],r=!1;n?t.del?(s.operations.push({editor:i,type:"delete",id:n.id,line:t}),r=!1):t.changed||t.num!==n.getBufferRange().start.row+1?(s.operations.push({editor:i,type:"delete",id:n.id,line:t}),r=!0):r=!1:t.del?(s.operations.push({editor:i,type:"delete",line:t}),r=!1):r=!0,r&&s.operations.push({editor:i,type:"create",line:t})})),n.allLines&&e.quokkaLineMessagesCSS._lines>o&&h._cleanUpLineMessagesCss(e),this._processMarkerOperationQueue(e)}_processMarkerOperationQueue(e){if(e.isDisposed()||!e.renderingQueue)return;let t=e.renderingQueue,i=t.operations.splice(0,u);if(i.length&&(e.quokkaLineMessagesCSS.innerHTML+=_.reduce(i,(function(t,i){let n=h._performMarkerOperation(e,i);return _.isString(n)&&(t+=n,e.quokkaLineMessagesCSS._lines++),t}),"")),e.renderingQueue.operations.length||e.changes&&e.changes.length||h._resetHideCSS(e),!t.operations.length)return void delete e.renderingQueue;let n=Math.floor(l*(i.length/u));setTimeout(_.bind(this._processMarkerOperationQueue,this,e),n)}_stop(e){e.disposable.dispose(),this._activeSessions.splice(this._activeSessions.findIndex((function(t){return t===e})),1),this._hideStatusIndicator(),this._panelView.hide()}_setupEnvironment(){this._quokkaFolder=n.join(o.homedir(),".quokka"),this._wallabyFolder=n.join(o.homedir(),".wallaby"),this._lkp=n.join(this._quokkaFolder,".qlc"),this._ol=n.join(this._wallabyFolder,".ol");try{s.existsSync(this._quokkaFolder)||s.mkdirSync(this._quokkaFolder)}catch(e){}try{s.existsSync(this._wallabyFolder)||s.mkdirSync(this._wallabyFolder)}catch(e){}const e=this._loadQuokkaConfig();1!=(this._pro=!0===e.pro)?(this._salesEvent=new r(this._$)).setup():new r(this._$).deleteStateConfig(),!0!==e.pro&&!1!==e.pro&&this._showNotification({text:`You are using Quokka.js 'Community' edition (free). Quokka.js 'Pro' edition with some advanced features is also available.<br/><br/><a href="#" class="use-community-link">Use 'Community' features only</a><br/><a href="#" class="use-pro-link">Try 'Pro' features as well</a><br/><a href="https://quokkajs.com/pro">Learn more about 'Pro' features</a>`,type:"info"})}_showNotification(e){var t=this,i=e.text,n=e.type;if(e.suggestProEdition?i+=`<br/><br/><a href="#" class="use-pro-link-start">Switch to 'Pro' edition</a><br/><a href="https://quokkajs.com/pro">Learn more about 'Pro' features</a>`:~i.indexOf("purchase")&&!e.expiryDate&&(i+=`<br/><a href="#" class="use-community-link">Switch to 'Community' edition</a>`),0===i.indexOf("Can not start node.js process")&&(i=i.replace(/<[^>]*>/g,""),i+=`<br/><br/>You may use the <a href="https://quokkajs.com/docs/configuration.html#nodejs-version">"node" setting</a> to configure the location of node.`),0!==i.indexOf("free upgrades period has expired")&&"disable"===atom.config.get("quokka-expired-reminder"))return;const s=atom.notifications["add"+n.charAt(0).toUpperCase()+n.substr(1)](i,{dismissable:!0}),o=atom.views.getView(s);let r=this._$(o.element);r.length||(r=this._$(o));let a;return r.on("mousedown",".use-community-link",(function(){t._switchEdition(!1,t._activeSession),s.dismiss()})),r.on("mousedown",".use-pro-link",(function(){t._switchEdition(!0,t._activeSession),s.dismiss()})),r.on("mousedown",".use-pro-link-start",(function(){t._switchEdition(!0,t._activeSession),s.dismiss()})),r.on("mousedown",".activate-link",(function(){t._showLicense(s)})),r.on("mousedown",".continue-trial-link",(function(){s.dismiss(),t._activeSession&&!t._activeSession.isDisposed()&&t._activeSession.continueTrial()})),a=s.onDidDismiss((function(){a&&a.dispose(),r.off("mousedown")})),s}_quokkaConfigPath(){return n.join(this._quokkaFolder,"config.json")}_loadQuokkaConfig(){const e=this._quokkaConfigPath();let t,i={};try{t=""+s.readFileSync(e),i=JSON.parse(t)}catch(e){t&&this._showNotification({text:"Looks like your quokka config.json file has invalid syntax, it should be a valid JSON file.",type:"warning"})}return i}_saveQuokkaConfig(e){s.writeFileSync(this._quokkaConfigPath(),JSON.stringify(e))}static _clearIdleSessionTimeout(e){e.idleTimeout&&(clearTimeout(e.idleTimeout),delete e.idleTimeout)}static _sessionIsActive(e){h._clearIdleSessionTimeout(e),e.gutter&&!e.gutter.visible&&e.gutter.show()}static _markerOptions(){return{invalidate:"never"}}static _resetHideCSS(e){e.quokkaLineMessagesHideCSS.innerHTML="",e.quokkaLineMessagesHideCSS._lines={}}static _performMarkerOperation(e,t){const i=e.editor;let n=t.id,s=t.line;switch(t.type){case"create":{let t=i.markBufferPosition([s.num-1,0],h._markerOptions());e.quokkaCoverageMarkers[s.id]=t,e.quokkaCoverageMarkerIdsToLineIds[t.id]=s.id;let n=document.createElement("span");n.setAttribute("data-line",s.num),i.gutterWithName("quokka").decorateMarker(t,{class:"quokka-cov-"+s.state,item:n});let o=h._lineMessageCss(s);if(o)return i.decorateMarker(t,{type:"line",class:"ql"+(s.err?"e":"c")}),i.decorateMarker(t,{type:"line",class:"ql"+s.id}),o;break}case"delete":if(!n){let t=e.quokkaCoverageMarkers[s.id];t&&(n=t.id)}_.isUndefined(n)||(i.destroyMarker(n),delete e.quokkaCoverageMarkers[s.id],delete e.quokkaCoverageMarkerIdsToLineIds[n])}}static _lineMessageCss(e){if(e.err||e.log){let t=h._cssEscape(e.err||e.log);return".ql"+e.id+'::after{content:"   '+t+'";}\n'}}static _cleanUpLineMessagesCss(e){let t=Object.create(null),i=0,n=(e.quokkaLineMessagesCSS.innerHTML||"").split("\n");n.reverse(),_.each(n,(function(n){try{if(!n)return;let s=parseInt(n.substring(3,n.indexOf(":")),10);!t[s]&&e.quokkaCoverageMarkers[s]&&(t[s]=n,i++)}catch(e){}})),e.quokkaLineMessagesCSS.innerHTML=_.reduce(t,(function(e,t){return e+=t+"\n"}),""),e.quokkaLineMessagesCSS._lines=i}static _hideInlineMessages(e,t,i){if(t!==atom.workspace.getActiveTextEditor())return;let n="";for(let s=Math.min(e.start,e.end),o=Math.min(s+5,Math.max(e.start,e.end)),r=s;r<=o;r++)_.each(t.findMarkers({startBufferRow:r}),(function(e){let t=i.quokkaCoverageMarkerIdsToLineIds[e.id];t&&!i.quokkaLineMessagesHideCSS._lines[t]&&(n+=h._lineWithoutMessage(t),i.quokkaLineMessagesHideCSS._lines[t]=!0)}));n&&(i.quokkaLineMessagesHideCSS.innerHTML+=n)}static _lineWithoutMessage(e){return".ql"+e+'::after{content:"";}\n'}static _getFileType(e){const t=(e.getGrammar()||{}).fileTypes;if(t)for(let e=0;e<t.length;e++){let i=t[e];if("ts"===i)return".ts";if("tsx"===i)return".tsx"}return".js"}static _getEditor(e,t){let i;return e&&e.target&&e.target.getModel?i=e.target.getModel():t&&t.getModel&&(i=t.getModel()),i&&i.getPath?i:i&&i.getActiveTextEditor?i.getActiveTextEditor():atom.workspace.getActiveTextEditor()}static _cssEscape(e){const t=e+"",i=t.length;let n,s=-1,o="";const r=t.charCodeAt(0);for(;++s<i;)(n=t.charCodeAt(s))>=1&&n<=31||127==n||0==s&&n>=48&&n<=57||1==s&&n>=48&&n<=57&&45==r?o+="\\"+n.toString(16)+" ":o+=n>=128||45==n||95==n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122?t.charAt(s):"\\"+t.charAt(s);return o}_updateConfigurationFromSettings(){let e="",t=!1;try{var i=this._loadQuokkaConfig();e=i.node,i.useWsl&&(t=i.useWsl)}catch(e){}process.env.WALLABY_USE_WSL=t,e?process.env.WALLABY_NODE=e:delete process.env.WALLABY_NODE}}t.default=new h}),(function(e,t,i){"use strict";const n=i(18),s={};n(s,i(9)),n(s,i(24)),n(s,i(14)),n(s,i(3)),n(s,i(7)),n(s,i(32)),n(s,i(36)),n(s,i(37)),n(s,i(38)),n(s,i(39)),n(s,i(45)),n(s,i(4)),e.exports=s}),(function(e,t,i){"use strict";e.exports=function(){const e=[].slice.call(arguments).filter(e=>e),t=e.shift();return e.forEach(e=>{Object.keys(e).forEach(i=>{t[i]=e[i]})}),t}}),(function(e,t,i){function n(e){e.lchmod=function(t,i,n){e.open(t,p.O_WRONLY|p.O_SYMLINK,i,(function(t,s){t?n&&n(t):e.fchmod(s,i,(function(t){e.close(s,(function(e){n&&n(t||e)}))}))}))},e.lchmodSync=function(t,i){var n,s=e.openSync(t,p.O_WRONLY|p.O_SYMLINK,i),o=!0;try{n=e.fchmodSync(s,i),o=!1}finally{if(o)try{e.closeSync(s)}catch(e){}else e.closeSync(s)}return n}}function s(e){p.hasOwnProperty("O_SYMLINK")?(e.lutimes=function(t,i,n,s){e.open(t,p.O_SYMLINK,(function(t,o){t?s&&s(t):e.futimes(o,i,n,(function(t){e.close(o,(function(e){s&&s(t||e)}))}))}))},e.lutimesSync=function(t,i,n){var s,o=e.openSync(t,p.O_SYMLINK),r=!0;try{s=e.futimesSync(o,i,n),r=!1}finally{if(r)try{e.closeSync(o)}catch(e){}else e.closeSync(o)}return s}):(e.lutimes=function(e,t,i,n){n&&process.nextTick(n)},e.lutimesSync=function(){})}function o(e){return e?function(t,i,n){return e.call(f,t,i,(function(e){d(e)&&(e=null),n&&n.apply(this,arguments)}))}:e}function r(e){return e?function(t,i){try{return e.call(f,t,i)}catch(e){if(!d(e))throw e}}:e}function a(e){return e?function(t,i,n,s){return e.call(f,t,i,n,(function(e){d(e)&&(e=null),s&&s.apply(this,arguments)}))}:e}function c(e){return e?function(t,i,n){try{return e.call(f,t,i,n)}catch(e){if(!d(e))throw e}}:e}function u(e){return e?function(t,i){return e.call(f,t,(function(e,t){if(!t)return i.apply(this,arguments);t.uid<0&&(t.uid+=4294967296),t.gid<0&&(t.gid+=4294967296),i&&i.apply(this,arguments)}))}:e}function l(e){return e?function(t){var i=e.call(f,t);return i.uid<0&&(i.uid+=4294967296),i.gid<0&&(i.gid+=4294967296),i}:e}function d(e){return!e||"ENOSYS"===e.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==e.code&&"EPERM"!==e.code)}var f=i(10),p=i(20),h=process.cwd,m=null,y=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return m||(m=h.call(process)),m};try{process.cwd()}catch(e){}var g=process.chdir;process.chdir=function(e){m=null,g.call(process,e)},e.exports=function(e){p.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&n(e),e.lutimes||s(e),e.chown=a(e.chown),e.fchown=a(e.fchown),e.lchown=a(e.lchown),e.chmod=o(e.chmod),e.fchmod=o(e.fchmod),e.lchmod=o(e.lchmod),e.chownSync=c(e.chownSync),e.fchownSync=c(e.fchownSync),e.lchownSync=c(e.lchownSync),e.chmodSync=r(e.chmodSync),e.fchmodSync=r(e.fchmodSync),e.lchmodSync=r(e.lchmodSync),e.stat=u(e.stat),e.fstat=u(e.fstat),e.lstat=u(e.lstat),e.statSync=l(e.statSync),e.fstatSync=l(e.fstatSync),e.lstatSync=l(e.lstatSync),e.lchmod||(e.lchmod=function(e,t,i){i&&process.nextTick(i)},e.lchmodSync=function(){}),e.lchown||(e.lchown=function(e,t,i,n){n&&process.nextTick(n)},e.lchownSync=function(){}),"win32"===y&&(e.rename=(function(t){return function(i,n,s){var o=Date.now(),r=0;t(i,n,(function a(c){if(c&&("EACCES"===c.code||"EPERM"===c.code)&&Date.now()-o<6e4)return setTimeout((function(){e.stat(n,(function(e,o){e&&"ENOENT"===e.code?t(i,n,a):s(c)}))}),r),void(r<100&&(r+=10));s&&s(c)}))}})(e.rename)),e.read=(function(t){return function(i,n,s,o,r,a){var c;if(a&&"function"==typeof a){var u=0;c=function(l,d,f){if(l&&"EAGAIN"===l.code&&u<10)return u++,t.call(e,i,n,s,o,r,c);a.apply(this,arguments)}}return t.call(e,i,n,s,o,r,c)}})(e.read),e.readSync=(function(t){return function(i,n,s,o,r){for(var a=0;;)try{return t.call(e,i,n,s,o,r)}catch(e){if("EAGAIN"===e.code&&a<10){a++;continue}throw e}}})(e.readSync)}}),(function(e,t){e.exports=require("constants")}),(function(e,t,i){var n=i(22).Stream;e.exports=function(e){function t(i,s){if(!(this instanceof t))return new t(i,s);n.call(this);var o=this;this.path=i,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,s=s||{};for(var r=Object.keys(s),a=0,c=r.length;a<c;a++){var u=r[a];this[u]=s[u]}if(this.encoding&&this.setEncoding(this.encoding),void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=Infinity;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw Error("start must be <= end");this.pos=this.start}null===this.fd?e.open(this.path,this.flags,this.mode,(function(e,t){if(e)return o.emit("error",e),void(o.readable=!1);o.fd=t,o.emit("open",t),o._read()})):process.nextTick((function(){o._read()}))}function i(t,s){if(!(this instanceof i))return new i(t,s);n.call(this),this.path=t,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,s=s||{};for(var o=Object.keys(s),r=0,a=o.length;r<a;r++){var c=o[r];this[c]=s[c]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}return{ReadStream:t,WriteStream:i}}}),(function(e,t){e.exports=require("stream")}),(function(e,t){e.exports=require("util")}),(function(e,t,i){const n=i(2).fromCallback;e.exports={copy:n(i(25))}}),(function(e,t,i){"use strict";const n=i(1),s=i(0),o=i(12),r=i(3),a=i(4).pathExists;e.exports=function(e,t,i,c){"function"!=typeof i||c?("function"==typeof i||i instanceof RegExp)&&(i={filter:i}):(c=i,i={}),c=c||function(){},(i=i||{}).preserveTimestamps&&"ia32"===process.arch&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269`);const u=process.cwd();if(s.resolve(u,e)===s.resolve(u,t))return c(Error("Source and destination must not be the same."));n.lstat(e,(n,u)=>{if(n)return c(n);let l=null;if(u.isDirectory()){const e=t.split(s.sep);e.pop(),l=e.join(s.sep)}else l=s.dirname(t);a(l,(n,s)=>n?c(n):s?o(e,t,i,c):void r.mkdirs(l,n=>{if(n)return c(n);o(e,t,i,c)}))})}}),(function(e,t,i){"use strict";const n=i(1);i(6),i(0),e.exports={hasMillisRes:null,hasMillisResSync:null,timeRemoveMillis:null,utimesMillis:function(e,t,i,s){n.open(e,"r+",(e,o)=>{if(e)return s(e);n.futimes(o,t,i,e=>{n.close(o,t=>{s&&s(e||t)})})})}}}),(function(e,t,i){"use strict";function n(e,t,i,c){if("function"==typeof t?(i=t,t={}):t&&"object"==typeof t||(t={mode:t}),"win32"===process.platform&&r(e)){const t=Error(e+" contains invalid WIN32 path characters.");return t.code="EINVAL",i(t)}let u=t.mode;const l=t.fs||s;void 0===u&&(u=a&~process.umask()),c||(c=null),i=i||function(){},e=o.resolve(e),l.mkdir(e,u,s=>{if(!s)return c=c||e,i(null,c);switch(s.code){case"ENOENT":if(o.dirname(e)===e)return i(s);n(o.dirname(e),t,(s,o)=>{s?i(s,o):n(e,t,i,o)});break;default:l.stat(e,(e,t)=>{e||!t.isDirectory()?i(s,c):i(null,c)})}})}const s=i(1),o=i(0),r=i(13).invalidWin32Path,a=parseInt("0777",8);e.exports=n}),(function(e,t,i){"use strict";function n(e,t,i){t&&"object"==typeof t||(t={mode:t});let c=t.mode;const u=t.fs||s;if("win32"===process.platform&&r(e)){const t=Error(e+" contains invalid WIN32 path characters.");throw t.code="EINVAL",t}void 0===c&&(c=a&~process.umask()),i||(i=null),e=o.resolve(e);try{u.mkdirSync(e,c),i=i||e}catch(s){switch(s.code){case"ENOENT":if(o.dirname(e)===e)throw s;n(e,t,i=n(o.dirname(e),t,i));break;default:let r;try{r=u.statSync(e)}catch(e){throw s}if(!r.isDirectory())throw s}}return i}const s=i(1),o=i(0),r=i(13).invalidWin32Path,a=parseInt("0777",8);e.exports=n}),(function(e,t,i){"use strict";function n(e,t,i){("function"==typeof i||i instanceof RegExp)&&(i={filter:i}),(i=i||{}).recursive=!!i.recursive,i.clobber=!("clobber"in i&&!i.clobber),i.overwrite="overwrite"in i?!!i.overwrite:i.clobber,i.dereference="dereference"in i&&!!i.dereference,i.preserveTimestamps="preserveTimestamps"in i&&!!i.preserveTimestamps,i.filter=i.filter||function(){return!0},i.preserveTimestamps&&"ia32"===process.arch&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269`);const c=i.recursive&&!i.dereference?s.lstatSync(e):s.statSync(e),u=o.dirname(t),l=s.existsSync(u);let d=!1;if(i.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),d=i.filter.test(e)):"function"==typeof i.filter&&(d=i.filter(e,t)),c.isFile()&&d)l||a.mkdirsSync(u),r(e,t,{overwrite:i.overwrite,errorOnExist:i.errorOnExist,preserveTimestamps:i.preserveTimestamps});else if(c.isDirectory()&&d)s.existsSync(t)||a.mkdirsSync(t),s.readdirSync(e).forEach(s=>{const r=i;r.recursive=!0,n(o.join(e,s),o.join(t,s),r)});else if(i.recursive&&c.isSymbolicLink()&&d){const i=s.readlinkSync(e);s.symlinkSync(i,t)}}const s=i(1),o=i(0),r=i(30),a=i(3);e.exports=n}),(function(e,t,i){"use strict";const n=i(1),s=i(15)(65536);e.exports=function(e,t,i){const o=i.overwrite,r=i.errorOnExist,a=i.preserveTimestamps;if(n.existsSync(t)){if(!o){if(r)throw Error(`${t} already exists`);return}n.unlinkSync(t)}const c=n.openSync(e,"r"),u=n.fstatSync(c),l=n.openSync(t,"w",u.mode);let d=1,f=0;for(;d>0;)d=n.readSync(c,s,0,65536,f),n.writeSync(l,s,0,d),f+=d;a&&n.futimesSync(l,u.atime,u.mtime),n.closeSync(c),n.closeSync(l)}}),(function(e,t,i){"use strict";function n(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{e[t]=e[t]||p[t],e[t+="Sync"]=e[t]||p[t]}),e.maxBusyTries=e.maxBusyTries||3}function s(e,t,i){let s=0;"function"==typeof t&&(i=t,t={}),m(e,"rimraf: missing path"),m.equal(typeof e,"string","rimraf: path should be a string"),m.equal(typeof i,"function","rimraf: callback function required"),m(t,"rimraf: invalid options argument provided"),m.equal(typeof t,"object","rimraf: options should be object"),n(t),o(e,t,(function n(r){if(r){if(("EBUSY"===r.code||"ENOTEMPTY"===r.code||"EPERM"===r.code)&&s<t.maxBusyTries){let i=100*++s;return setTimeout(()=>o(e,t,n),i)}"ENOENT"===r.code&&(r=null)}i(r)}))}function o(e,t,i){m(e),m(t),m("function"==typeof i),t.lstat(e,(n,s)=>n&&"ENOENT"===n.code?i(null):n&&"EPERM"===n.code&&y?r(e,t,n,i):s&&s.isDirectory()?c(e,t,n,i):void t.unlink(e,n=>{if(n){if("ENOENT"===n.code)return i(null);if("EPERM"===n.code)return y?r(e,t,n,i):c(e,t,n,i);if("EISDIR"===n.code)return c(e,t,n,i)}return i(n)}))}function r(e,t,i,n){m(e),m(t),m("function"==typeof n),i&&m(i instanceof Error),t.chmod(e,666,s=>{s?n("ENOENT"===s.code?null:i):t.stat(e,(s,o)=>{s?n("ENOENT"===s.code?null:i):o.isDirectory()?c(e,t,i,n):t.unlink(e,n)})})}function a(e,t,i){let n;m(e),m(t),i&&m(i instanceof Error);try{t.chmodSync(e,666)}catch(e){if("ENOENT"===e.code)return;throw i}try{n=t.statSync(e)}catch(e){if("ENOENT"===e.code)return;throw i}n.isDirectory()?d(e,t,i):t.unlinkSync(e)}function c(e,t,i,n){m(e),m(t),i&&m(i instanceof Error),m("function"==typeof n),t.rmdir(e,s=>{!s||"ENOTEMPTY"!==s.code&&"EEXIST"!==s.code&&"EPERM"!==s.code?n(s&&"ENOTDIR"===s.code?i:s):u(e,t,n)})}function u(e,t,i){m(e),m(t),m("function"==typeof i),t.readdir(e,(n,o)=>{if(n)return i(n);let r,a=o.length;if(0===a)return t.rmdir(e,i);o.forEach(n=>{s(h.join(e,n),t,n=>{if(!r)return n?i(r=n):void(0==--a&&t.rmdir(e,i))})})})}function l(e,t){let i;n(t=t||{}),m(e,"rimraf: missing path"),m.equal(typeof e,"string","rimraf: path should be a string"),m(t,"rimraf: missing options"),m.equal(typeof t,"object","rimraf: options should be object");try{i=t.lstatSync(e)}catch(i){if("ENOENT"===i.code)return;"EPERM"===i.code&&y&&a(e,t,i)}try{i&&i.isDirectory()?d(e,t,null):t.unlinkSync(e)}catch(i){if("ENOENT"===i.code)return;if("EPERM"===i.code)return y?a(e,t,i):d(e,t,i);if("EISDIR"!==i.code)throw i;d(e,t,i)}}function d(e,t,i){m(e),m(t),i&&m(i instanceof Error);try{t.rmdirSync(e)}catch(n){if("ENOTDIR"===n.code)throw i;if("ENOTEMPTY"===n.code||"EEXIST"===n.code||"EPERM"===n.code)f(e,t);else if("ENOENT"!==n.code)throw n}}function f(e,t){m(e),m(t),t.readdirSync(e).forEach(i=>l(h.join(e,i),t));const i=y?100:1;let n=0;for(;;){let s=!0;try{return s=!1,t.rmdirSync(e,t)}finally{if(++n<i&&s)continue}}}const p=i(1),h=i(0),m=i(11),y="win32"===process.platform;e.exports=s,s.sync=l}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(8);s.outputJson=n(i(34)),s.outputJsonSync=i(35),s.outputJSON=s.outputJson,s.outputJSONSync=s.outputJsonSync,s.writeJSON=s.writeJson,s.writeJSONSync=s.writeJsonSync,s.readJSON=s.readJson,s.readJSONSync=s.readJsonSync,e.exports=s}),(function(e,t,i){function n(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e=e.replace(/^\uFEFF/,"")}var s;try{s=i(1)}catch(e){s=i(5)}var o={spaces:null,readFile:function(e,t,i){null==i&&(i=t,t={}),"string"==typeof t&&(t={encoding:t});var o=(t=t||{}).fs||s,r=!0;"passParsingErrors"in t?r=t.passParsingErrors:"throws"in t&&(r=t.throws),o.readFile(e,t,(function(s,o){if(s)return i(s);o=n(o);var a;try{a=JSON.parse(o,t?t.reviver:null)}catch(t){return r?(t.message=e+": "+t.message,i(t)):i(null,null)}i(null,a)}))},readFileSync:function(e,t){"string"==typeof(t=t||{})&&(t={encoding:t});var i=t.fs||s,o=!0;"passParsingErrors"in t?o=t.passParsingErrors:"throws"in t&&(o=t.throws);try{var r=i.readFileSync(e,t);return r=n(r),JSON.parse(r,t.reviver)}catch(t){if(o)throw t.message=e+": "+t.message,t;return null}},writeFile:function(e,t,i,n){null==n&&(n=i,i={});var o=(i=i||{}).fs||s,r="object"==typeof i&&null!==i&&"spaces"in i?i.spaces:this.spaces,a="";try{a=JSON.stringify(t,i?i.replacer:null,r)+"\n"}catch(e){return void(n&&n(e,null))}o.writeFile(e,a,i,n)},writeFileSync:function(e,t,i){var n=(i=i||{}).fs||s,o="object"==typeof i&&null!==i&&"spaces"in i?i.spaces:this.spaces,r=JSON.stringify(t,i.replacer,o)+"\n";return n.writeFileSync(e,r,i)}};e.exports=o}),(function(e,t,i){"use strict";const n=i(0),s=i(3),o=i(4).pathExists,r=i(8);e.exports=function(e,t,i,a){"function"==typeof i&&(a=i,i={});const c=n.dirname(e);o(c,(n,o)=>n?a(n):o?r.writeJson(e,t,i,a):void s.mkdirs(c,n=>{if(n)return a(n);r.writeJson(e,t,i,a)}))}}),(function(e,t,i){"use strict";const n=i(1),s=i(0),o=i(3),r=i(8);e.exports=function(e,t,i){const a=s.dirname(e);n.existsSync(a)||o.mkdirsSync(a),r.writeJsonSync(e,t,i)}}),(function(e,t,i){"use strict";function n(e,t,i,o){function r(){d.resolve(e)===d.resolve(t)?u.access(e,o):c?u.rename(e,t,r=>{if(!r)return o();if("ENOTEMPTY"!==r.code&&"EEXIST"!==r.code){if("EPERM"!==r.code)return"EXDEV"!==r.code?o(r):void s(e,t,c,o);setTimeout(()=>{f(t,s=>{if(s)return o(s);i.overwrite=!1,n(e,t,i,o)})},200)}else f(t,s=>{if(s)return o(s);i.overwrite=!1,n(e,t,i,o)})}):u.link(e,t,i=>i?"EXDEV"===i.code||"EISDIR"===i.code||"EPERM"===i.code||"ENOTSUP"===i.code?s(e,t,c,o):o(i):u.unlink(e,o))}"function"==typeof i&&(o=i,i={});const c=i.overwrite||i.clobber||!1;a(e,t,(i,n)=>i?o(i):n?o(Error(`Cannot move '${e}' to a subdirectory of itself, '${t}'.`)):void p(d.dirname(t),e=>{if(e)return o(e);r()}))}function s(e,t,i,n){u.stat(e,(s,a)=>{if(s)return n(s);a.isDirectory()?r(e,t,i,n):o(e,t,i,n)})}function o(e,t,i,n){function s(){u.unlink(e,n)}const o=i?"w":"wx",a=u.createReadStream(e),c=u.createWriteStream(t,{flags:o});a.on("error",o=>{a.destroy(),c.destroy(),c.removeListener("close",s),u.unlink(t,()=>{"EISDIR"===o.code||"EPERM"===o.code?r(e,t,i,n):n(o)})}),c.on("error",e=>{a.destroy(),c.destroy(),c.removeListener("close",s),n(e)}),c.once("close",s),a.pipe(c)}function r(e,t,i,n){function s(){l(e,t,o,t=>{if(t)return n(t);f(e,n)})}const o={overwrite:!1};i?f(t,e=>{if(e)return n(e);s()}):s()}function a(e,t,i){u.stat(e,(n,s)=>{if(n)return i(n);if(s.isDirectory()){const n=t.split(d.dirname(e)+d.sep)[1];if(n){const s=n.split(d.sep)[0];return s?i(null,e!==t&&t.indexOf(e)>-1&&s===d.basename(e)):i(null,!1)}return i(null,!1)}return i(null,!1)})}const c=i(2).fromCallback,u=i(1),l=i(12),d=i(0),f=i(7).remove,p=i(3).mkdirs;e.exports={move:c(n)}}),(function(e,t,i){"use strict";function n(e,t,i){const o=(i=i||{}).overwrite||i.clobber||!1;if(e=u.resolve(e),t=u.resolve(t),e===t)return c.accessSync(e);if(a(e,t))throw Error(`Cannot move '${e}' into itself '${t}'.`);f(u.dirname(t)),(function(){if(o)try{c.renameSync(e,t)}catch(r){if("ENOTEMPTY"===r.code||"EEXIST"===r.code||"EPERM"===r.code)return d(t),i.overwrite=!1,n(e,t,i);if("EXDEV"!==r.code)throw r;return s(e,t,o)}else try{c.linkSync(e,t),c.unlinkSync(e)}catch(i){if("EXDEV"===i.code||"EISDIR"===i.code||"EPERM"===i.code||"ENOTSUP"===i.code)return s(e,t,o);throw i}})()}function s(e,t,i){return c.statSync(e).isDirectory()?r(e,t,i):o(e,t,i)}function o(e,t,i){const n=p(65536),s=i?"w":"wx",o=c.openSync(e,"r"),r=c.fstatSync(o),a=c.openSync(t,s,r.mode);let u=1,l=0;for(;u>0;)u=c.readSync(o,n,0,65536,l),c.writeSync(a,n,0,u),l+=u;return c.closeSync(o),c.closeSync(a),c.unlinkSync(e)}function r(e,t,i){function n(){return l(e,t,s),d(e)}const s={overwrite:!1};i?(d(t),n()):n()}function a(e,t){try{return c.statSync(e).isDirectory()&&e!==t&&t.indexOf(e)>-1&&t.split(u.dirname(e)+u.sep)[1].split(u.sep)[0]===u.basename(e)}catch(e){return!1}}const c=i(1),u=i(0),l=i(14).copySync,d=i(7).removeSync,f=i(3).mkdirsSync,p=i(15);e.exports={moveSync:n}}),(function(e,t,i){"use strict";function n(e){let t;try{t=o.readdirSync(e)}catch(t){return a.mkdirsSync(e)}t.forEach(t=>{t=r.join(e,t),c.removeSync(t)})}const s=i(2).fromCallback,o=i(5),r=i(0),a=i(3),c=i(7),u=s((function(e,t){t=t||function(){},o.readdir(e,(i,n)=>{function s(){const e=n.pop();if(!e)return t();c.remove(e,e=>{if(e)return t(e);s()})}if(i)return a.mkdirs(e,t);n=n.map(t=>r.join(e,t)),s()})}));e.exports={emptyDirSync:n,emptydirSync:n,emptyDir:u,emptydir:u}}),(function(e,t,i){"use strict";const n=i(40),s=i(41),o=i(42);e.exports={createFile:n.createFile,createFileSync:n.createFileSync,ensureFile:n.createFile,ensureFileSync:n.createFileSync,createLink:s.createLink,createLinkSync:s.createLinkSync,ensureLink:s.createLink,ensureLinkSync:s.createLinkSync,createSymlink:o.createSymlink,createSymlinkSync:o.createSymlinkSync,ensureSymlink:o.createSymlink,ensureSymlinkSync:o.createSymlinkSync}}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(0),o=i(1),r=i(3),a=i(4).pathExists;e.exports={createFile:n((function(e,t){function i(){o.writeFile(e,"",e=>{if(e)return t(e);t()})}o.stat(e,(n,o)=>{if(!n&&o.isFile())return t();const c=s.dirname(e);a(c,(e,n)=>e?t(e):n?i():void r.mkdirs(c,e=>{if(e)return t(e);i()}))})})),createFileSync:function(e){let t;try{t=o.statSync(e)}catch(e){}if(t&&t.isFile())return;const i=s.dirname(e);o.existsSync(i)||r.mkdirsSync(i),o.writeFileSync(e,"")}}}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(0),o=i(1),r=i(3),a=i(4).pathExists;e.exports={createLink:n((function(e,t,i){function n(e,t){o.link(e,t,e=>{if(e)return i(e);i(null)})}a(t,(c,u)=>c?i(c):u?i(null):void o.lstat(e,(o,c)=>{if(o)return o.message=o.message.replace("lstat","ensureLink"),i(o);const u=s.dirname(t);a(u,(s,o)=>s?i(s):o?n(e,t):void r.mkdirs(u,s=>{if(s)return i(s);n(e,t)}))}))})),createLinkSync:function(e,t,i){if(o.existsSync(t))return;try{o.lstatSync(e)}catch(e){throw e.message=e.message.replace("lstat","ensureLink"),e}const n=s.dirname(t);return o.existsSync(n)?o.linkSync(e,t):(r.mkdirsSync(n),o.linkSync(e,t))}}}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(0),o=i(1),r=i(3),a=r.mkdirs,c=r.mkdirsSync,u=i(43),l=u.symlinkPaths,d=u.symlinkPathsSync,f=i(44),p=f.symlinkType,h=f.symlinkTypeSync,m=i(4).pathExists;e.exports={createSymlink:n((function(e,t,i,n){n="function"==typeof i?i:n,i="function"!=typeof i&&i,m(t,(r,c)=>r?n(r):c?n(null):void l(e,t,(r,c)=>{if(r)return n(r);e=c.toDst,p(c.toCwd,i,(i,r)=>{if(i)return n(i);const c=s.dirname(t);m(c,(i,s)=>i?n(i):s?o.symlink(e,t,r,n):void a(c,i=>{if(i)return n(i);o.symlink(e,t,r,n)}))})}))})),createSymlinkSync:function(e,t,i,n){if(n="function"==typeof i?i:n,i="function"!=typeof i&&i,o.existsSync(t))return;const r=d(e,t);e=r.toDst,i=h(r.toCwd,i);const a=s.dirname(t);return o.existsSync(a)?o.symlinkSync(e,t,i):(c(a),o.symlinkSync(e,t,i))}}}),(function(e,t,i){"use strict";const n=i(0),s=i(1),o=i(4).pathExists;e.exports={symlinkPaths:function(e,t,i){if(n.isAbsolute(e))return s.lstat(e,(t,n)=>t?(t.message=t.message.replace("lstat","ensureSymlink"),i(t)):i(null,{toCwd:e,toDst:e}));{const r=n.dirname(t),a=n.join(r,e);return o(a,(t,o)=>t?i(t):o?i(null,{toCwd:a,toDst:e}):s.lstat(e,(t,s)=>t?(t.message=t.message.replace("lstat","ensureSymlink"),i(t)):i(null,{toCwd:e,toDst:n.relative(r,e)})))}},symlinkPathsSync:function(e,t){let i;if(n.isAbsolute(e)){if(!(i=s.existsSync(e)))throw Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}{const o=n.dirname(t),r=n.join(o,e);if(i=s.existsSync(r))return{toCwd:r,toDst:e};if(!(i=s.existsSync(e)))throw Error("relative srcpath does not exist");return{toCwd:e,toDst:n.relative(o,e)}}}}}),(function(e,t,i){"use strict";const n=i(1);e.exports={symlinkType:function(e,t,i){if(i="function"==typeof t?t:i,t="function"!=typeof t&&t)return i(null,t);n.lstat(e,(e,n)=>{if(e)return i(null,"file");t=n&&n.isDirectory()?"dir":"file",i(null,t)})},symlinkTypeSync:function(e,t){let i;if(t)return t;try{i=n.lstatSync(e)}catch(e){return"file"}return i&&i.isDirectory()?"dir":"file"}}}),(function(e,t,i){"use strict";const n=i(2).fromCallback,s=i(1),o=i(0),r=i(3),a=i(4).pathExists;e.exports={outputFile:n((function(e,t,i,n){"function"==typeof i&&(n=i,i="utf8");const c=o.dirname(e);a(c,(o,a)=>o?n(o):a?s.writeFile(e,t,i,n):void r.mkdirs(c,o=>{if(o)return n(o);s.writeFile(e,t,i,n)}))})),outputFileSync:function(e,t,i){const n=o.dirname(e);if(s.existsSync(n))return s.writeFileSync.apply(s,arguments);r.mkdirsSync(n),s.writeFileSync.apply(s,arguments)}}}),(function(e,t,i){var n=i(0),s=i(5),o=i(6);e.exports=class{constructor(e,t,i){this.atomViews=e,this.start=t||new Date(Date.UTC(2019,10,27,0,0,0,0)),this.end=i||new Date(Date.UTC(2019,11,4,0,0,0,0)),this.config=n.join(o.homedir(),".quokka","state.json"),this.nextCheckTime=void 0,this.disposed=!1}setup(){var e=this;new Date>this.end?this.deleteStateConfig():(this.nextCheckTime=this.getNextCheckTime()||this.start)<this.end&&(this.disposable=atom.workspace.observeTextEditors((function(){const t=new Date;!e.disposed&&t>e.start&&t<e.end&&e.nextCheckTime&&t>=e.nextCheckTime&&(e.nextCheckTime=e.setNextCheckTime(),e.showMessage(e.disposable))})))}showMessage(e){var t=this;const i=atom.notifications.addInfo('Get Quokka.js PRO today with our limited time 50% Black Friday discount!<br><br><a href="https://quokkajs.com/pro/#personal-pro">Click here to buy a license</a>, or <a href="https://quokkajs.com/pro">here to learn more</a>.<br><br><a href="#" class="do-not-show-again-link">Do not show again</a>',{dismissable:!0}),n=atom.views.getView(i);let s=this.atomViews(n.element);s.length||(s=this.atomViews(n));let o;s.on("mousedown",".do-not-show-again-link",(function(){t.setNextCheckTimeAfterToDate(),t.nextCheckTime=t.end,i.dismiss(),e.dispose()})),o=i.onDidDismiss((function(){o&&o.dispose(),s.off("mousedown")}))}setNextCheckTimeAfterToDate(){try{s.writeFileSync(this.config,JSON.stringify({nextCheck:this.end}))}catch(e){}}deleteStateConfig(){try{s.existsSync(this.config)&&s.unlinkSync(this.config)}catch(e){}}dispose(){this.disposable&&this.disposable.dispose(),this.disposed=!0}setNextCheckTime(){const e=new Date,t=new Date(e.setDate(e.getDate()+1));try{s.writeFileSync(this.config,JSON.stringify({nextCheck:t}))}catch(e){}return t}getNextCheckTime(){try{if(s.existsSync(this.config)){const e=""+s.readFileSync(this.config),t=JSON.parse(e);return new Date(t.nextCheck)}return}catch(e){this.deleteStateConfig()}}}}),(function(e,t,i){"use babel";const n=100,s=2e3,o=512e3;e.exports=function(e,t,r,a){const c=i(48)(a);class u extends t{static content(){return this.div({class:"quokka-results-view native-key-bindings",tabindex:-1,contenteditable:!0})}display(t){var i=this;let n=t.navigator,s=t.installer,a=t.blur,u=t.data,l=t.focus,d=this,f=c.html(u,t.hasOpenedProject);f&&f.length>o&&(f='<section class="error"><section class="header"><strong>Logging is stopped because too much data is being logged</strong></section></section>'+this.html(),t.stopLogging=!0),this.clearView(),this.html(f),this.on("click","a.loc",(function(t){let i=e(t.target);n(i.data("file"),i.data("loc"))})),this.on("click","a.install-package-quokka",(function(){return s()})),this.on("click","a.install-package-project",(function(){return s(void 0,!0)})),this.on("click","a.install-browser-plugin",(function(){return s(void 0,!1,!0)})),this.on("cut",(function(e){return e.preventDefault()})),this.on("paste",(function(e){return e.preventDefault()})),this.on("focus",(function(){i._disposables=new r,i._disposables.add(atom.commands.add(".quokka-results-view",{"tool-panel:unfocus":function(){return atom.workspace.getActivePane().activate()}})),d._range&&document.getSelection().addRange(d._range)})),this.on("blur",(function(e){try{const t=document.getSelection();d._range=t&&t.getRangeAt(0)}catch(e){delete d._range}d._disposables&&(d._disposables.dispose(),delete d._disposables),a&&a()})),this.on("keydown",(function(t){switch(t.which){case 13:let i=document.getSelection().anchorNode;return!!i&&!!(i=3===i.nodeType?i.parentNode:i)&&(((i=e(i)).hasClass("loc")||i.hasClass("all"))&&i.click(),!1);case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 17:case 91:return!0;default:if((67===t.keyCode||65===t.keyCode)&&(t.ctrlKey||t.metaKey))return!0}return!1})),l&&this.focusView()}focusView(){this.is(":empty")||this.focus()}clearView(){this.off(),this.empty(),delete this._range,this._disposables&&(this._disposables.dispose(),delete this._disposables)}}return class extends t{static content(){let e=this;return e.div({class:"quokka-panel-view"},(function(){e.div({class:"quokka-panel-view-resizer-bottom",outlet:"resizerBottom"}),e.div({class:"quokka-panel-view-resizer-right",outlet:"resizerRight"}),e.div({class:"quokka-panel-view-resizer-top",outlet:"resizerTop"}),e.div({class:"quokka-panel-view-resizer-left",outlet:"resizerLeft"}),e.div({class:"quokka-panel-view-container"},(function(){e.header({class:"quokka-panel-view-header header"},(function(){e.span({class:"header-item subtle-info-message",outlet:"headerLabel"}),e.span({class:"header-item icons pull-right inline-block btn-group"},(function(){e.span({class:"icon icon-x",tabindex:-1,outlet:"hideButton"})}))})),e.section({class:"quokka-panel-view-content"},(function(){return e.subview("results",new u)}))}))}))}initialize(t){let i=this,s=_.bind(this._displayResults,this);this._displayResults=_.debounce(s,n),this._disposables=new r;let o=_.bind(this._resize,this);this.on("mousedown",".quokka-panel-view-resizer-bottom, .quokka-panel-view-resizer-right, .quokka-panel-view-resizer-top, .quokka-panel-view-resizer-left",(function(){e(document).on("mousemove",o),e(document).one("mouseup",(function(){e(document).off("mousemove",o),delete i._lastClientY,delete i._lastClientX}))})),(this._params=t||{}).results={},this.hideButton.click(_.bind(this.togglePanel,this)),this._disposables.add(atom.tooltips.add(e(this.hideButton)[0],{title:"Toggle Quokka.js Output Panel",keyBindingCommand:"quokka:toggle-output",trigger:"hover"})),this._displayResults(this._params.focus)}togglePanel(e){this.toggle(),this._displayResults(e)}showPanel(e){this._outputPanelAdded||(e=e||"Bottom",atom.workspace[`add${e}Panel`]||(e="Bottom"),"Bottom"===e?(this.resizerTop.height(0),this.resizerRight.width(0),this.resizerLeft.width(0)):"Right"===e?(this.resizerBottom.height(0),this.resizerTop.height(0),this.resizerLeft.width(0)):"Top"===e?(this.resizerBottom.height(0),this.resizerRight.width(0),this.resizerLeft.width(0)):"Left"===e&&(this.resizerBottom.height(0),this.resizerTop.height(0),this.resizerRight.width(0)),this._outputPosition=e,atom.workspace[`add${e}Panel`].call(atom.workspace,{item:this}),this._outputPanelAdded=!0),this.show(),this._displayResults()}focusPanel(){this.isVisible()?this.results.focusView():this.togglePanel(!0)}deactivate(){this._disposables.dispose()}setHeaderData(e){let t=e.plugins||[];this.headerLabel.text(`Quokka (node: ${e.nodeVersion}${e.ts?`, TypeScript: ${e.ts.version&&"v"+e.ts.version||"unknown version"}`:""}${e.babel?`, babel: ${e.babel.version&&"v"+e.babel.version||"unknown version"}`:""}${t.length?`, plugins: ${t.join(", ")}`:""})`)}showHeaderOnly(){this._params.results={},this._displayResults()}clearResults(){this._params.results={},this.results.clearView()}newResultsExpectedSoon(){delete this._stopLogging}appendConsoleMessages(e){this._stopLogging||(((this._params.results=this._params.results||{}).messages=(this._params.results.messages||[]).concat(e)).length>s&&this._params.results.messages.splice(0,this._params.results.messages.length-s),this._displayResults())}resultsReport(e){this._params.results=e,delete this._stopLogging,this._displayResults()}_displayResults(e){let t=this._params.results;if(!this.isVisible()||!t||this._stopLogging)return;let i={navigator:this._params.navigate,installer:this._params.installPackage,hasOpenedProject:this._params.hasOpenedProject,data:t,focus:e,results:!0};this.results.display(i),i.stopLogging&&(this._stopLogging=!0)}_resize(e){if(1===e.which)if("Bottom"===this._outputPosition||"Top"===this._outputPosition){if(this._lastClientY){let t=this.height(),i=this._lastClientY-e.clientY;"Bottom"===this._outputPosition&&(i<0||i>0&&e.clientY<=this.offset().top)?this.height(t+i):"Top"===this._outputPosition&&this.height(t-i)}this._lastClientY=e.clientY}else{if(this._lastClientX){let t=this.width(),i=this._lastClientX-e.clientX;"Right"===this._outputPosition&&(i<0||i>0&&e.clientX<=this.offset().left)?this.width(t+i):"Left"===this._outputPosition&&this.width(t-i)}this._lastClientX=e.clientX}}}}}),(function(e,t){"use babel";e.exports=function(e){return{html:function(e,t){const i=this;i._hasOpenedProject=t;let n="";return _.isString(e)?n+=i._error(e):_.isObject(e)&&(_.each(e.errors,(function(e){n+=i._error(e.message,e.stack,e.expected,e.actual,e.missingPackage,e.missingBrowserGlobal)})),_.each(e.messages,(function(e){n+=i._message(e)}))),n},_error:function(e,t,i,n,s,o){const r=this;let a="";s&&(a=`<section class="error"><a class="install-package-quokka link">Install "${s}" package for the current quokka file</a>`+(r._hasOpenedProject?`<br/><a class="install-package-project link">Install "${s}" package into the project</a>`:"")+"</section>");let c="";o&&(c=`<section class="error">"${o}" looks like a browser global\n            <br/><br/><a class="install-browser-plugin link">Install and use quokka browser plugin</a>\n            <br/><a class="link" href="https://github.com/wallabyjs/jsdom-quokka-plugin">Open quokka browser plugin documentation</a>\n        </section>`);let u="";return(i||n)&&(u=r._diff(i,n)+"<br/>"),a+c+'<section class="error">'+u+'<section class="header">'+r._escapeAndConvertToHtml(e)+"</section>"+_.reduce(t,(function(e,t){return e+=r._line(t)}),"")+"</section>"},_line:function(e){const t=this._escape(e.file),i=e.context&&this._escape(e.context)||"";return t?'<section class="line">at '+(i?'<span class="context">'+i+"</span> ":"")+'<a class="loc" data-file="'+t+'" data-loc="'+e.loc+'">'+t+":"+e.loc+"</a></section>":""},_message:function(e){let t="diff"===e.type;if(t){if(!e.context&&!e.actual&&!e.expected)return"";e.text=e.context,delete e.context}return(t?this._diff(e.expected,e.actual):"")+'<section class="message '+e.type+(t?" pad":"")+'"><span class="'+(t?"context":"text")+'">'+this._escapeAndConvertToHtml(e.text)+"&nbsp;</span>"+this._line(e)+"</section>"},_diff:function(t,i){try{return'<section class="diff" style="white-space: pre;">'+e.diff_prettyHtml(e.diff_wordMode(t||"",i||"")).replace(/&para;<br>/g,"<br>").replace(/style="background:#e6ffe6;"/g,'class="status-added"').replace(/style="background:#ffe6e6;"/g,'class="status-removed"')+"</section>"}catch(e){return""}},_escape:function(e){return(""+(e||"")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_escapeAndConvertToHtml:function(e){return this._escape(e).replace(/(?:\r\n|\r|\n)/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g,"&nbsp;")}}}}),(function(e,t,i){"use babel";let n=["January","February","March","April","May","June","July","August","September","October","November","December"];const s=i(0),o=i(6),r=/^[a-zA-Z0-9_+&*-]+(?:\.[a-zA-Z0-9_+&*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,63}$/;e.exports=function(e,t,i,a,c){return class e extends t{static content(){let e=this;return e.div({class:"block"},(function(){e.div({class:"block"},(function(){e.span("Registered to: "),e.span({outlet:"licensee",class:"text-success"},"")})),e.div({class:"block"},(function(){e.span("Free upgrades until: "),e.span({outlet:"expiration",class:"text-success"},"")})),e.div({class:"block"},(function(){e.label("License key:"),e.subview("licenseKey",new i({mini:!0}))})),e.div({class:"block"},(function(){e.button({class:"btn inline-block",outlet:"saveButton"},"Apply"),e.button({class:"btn inline-block",outlet:"cancelButton"},"Cancel")}))}))}display(t){let i=this;this._disposables=new a;let n=function(e){i._disposables.dispose(),delete i._disposables,t.closeView(e)},u=this.licenseKey.model;this.cancelButton.click((function(){return n()})),this.saveButton.click((function(){let a=i._originalLicenseKey,l=u.getText()||"",d=!1;if(r.test(l)){let e;try{e=JSON.parse(Buffer.from(""+c.readFileSync(t.onlineFilePath),"base64"))||{}}catch(t){e={}}try{e.email=l.trim(),e.lastUpdate=(new Date).getTime(),c.writeFileSync(t.onlineFilePath,Buffer.from(JSON.stringify(e)).toString("base64")),atom.notifications.addInfo("You must start Quokka to complete the activation process.",{dismissable:!0})}catch(e){atom.notifications.addError(e.message,{dismissable:!0}),d=!1}return void n(d)}try{c.unlinkSync(t.onlineFilePath)}catch(e){}let f=!!e._parseKey(a,t.parseKey),p=e._parseKey(l,t.parseKey),h=!!p;if(h||!l&&f)try{if(c.writeFileSync(t.keyFilePath,l),p.isBundle){let e=s.join(o.homedir(),".wallaby"),t=s.join(e,"key.lic");c.existsSync(e)||c.mkdirSync(e),c.writeFileSync(t,l)}d=h}catch(e){atom.notifications.addError(e.message,{dismissable:!0}),d=!1}n(d)})),this._onlineEmail="";try{const e=JSON.parse(Buffer.from(""+c.readFileSync(t.onlineFilePath),"base64"));this._onlineEmail=e.email&&e.email||""}catch(e){}try{this._originalLicenseKey=""+c.readFileSync(t.keyFilePath)}catch(e){}this._onlineEmail?(u.setText(this._onlineEmail),this._updateLicenseDetails(u,t.parseKey)):this._originalLicenseKey.length>100&&(u.setText(this._originalLicenseKey),this._updateLicenseDetails(u,t.parseKey)),this._disposables.add(u.onDidChange((function(){return i._updateLicenseDetails(u,t.parseKey)})))}_updateLicenseDetails(t,i){const s=t.getText(),o=r.test(s);let a;if(a=o?this._onlineEmail&&t.getText()===this._onlineEmail?e._parseKey(this._originalLicenseKey,i):"":e._parseKey(s,i),this.licensee.text(""),this.expiration.text(""),a){this.licensee.text(a.licensee);let e=a.expiration;try{let t=a.expiration.split("/");3===t.length&&(e=(e=new Date(t[1]+"/"+t[0]+"/"+t[2])).getDate()+" "+n[e.getMonth()]+" "+e.getFullYear())}catch(e){}this.expiration.text(e)}else o&&(this.licensee.text(s),this.expiration.text("<will be updated after activation>"))}static _parseKey(e,t){if(_.isString(e))try{let i=t(e);if(i.licenseeName&&i.expirationDateString&&~i.licensedProduct.indexOf("Quokka"))return{licensee:i.licenseeName,isBundle:0===i.licensedProduct.indexOf("Wallaby.js + Quokka.js"),expiration:i.expirationDateString}}catch(e){return}}focusView(){this.licenseKey.focus()}}}})]).default;